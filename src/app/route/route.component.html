<h3>{{ sectionHeading }}</h3>

<form [formGroup]="routeForm" (ngSubmit)="onSubmit()">
  <mat-form-field class="formField" appearance="fill">
    <mat-label>Departure Airport</mat-label>
    <mat-select
      formControlName="departureAirport"
      [value]="selectedAirport"
      required
    >
      <mat-option *ngFor="let airport of airports" [value]="airport">
        {{ airport.name }}
      </mat-option>
    </mat-select>
    <mat-hint align="start">Select an airport</mat-hint>
  </mat-form-field>

  <mat-form-field class="formField" appearance="fill">
    <mat-label>Destination Airport</mat-label>
    <mat-select formControlName="destinationAirport" required>
      <mat-option *ngFor="let airport of airports" [value]="airport">
        {{ airport.name }}
      </mat-option>
    </mat-select>
    <mat-hint align="start">Select an airport</mat-hint>
  </mat-form-field>

  <mat-form-field class="formField" appearance="fill">
    <mat-label>Number of passengers</mat-label>
    <input
      matInput
      type="number"
      min="1"
      formControlName="numPassengers"
      required
    />
    <mat-hint align="start">Must be a whole number greater than 0</mat-hint>
    <mat-error>Not a whole number greater than 0</mat-error>
  </mat-form-field>

  <div>
    <mat-checkbox formControlName="calculateReturn" [checked]="calculateReturn"
      >Calculate return</mat-checkbox
    >
  </div>

  <p>Enter all the clues above, press submit and I will investigate</p>
  <button
    mat-raised-button
    color="primary"
    type="submit"
    [disabled]="!routeForm.valid"
  >
    Submit
  </button>
</form>

<div *ngIf="formSubmitting">
  <p>Investigating...<mat-progress-bar></mat-progress-bar></p>
</div>

<section *ngIf="outboundDetails">
  <h3>Outbound Journey</h3>
  <mat-list
    *ngFor="
      let airport of outboundDetails.details.journey;
      index as i;
      first as departure;
      last as destination
    "
  >
    <mat-list-item>
      <p matLine>{{airport}}</p>
      <p matLine *ngIf="!departure">{{outboundDetails.details.miles[i - 1]}} miles</p>
    </mat-list-item>
  </mat-list>
  <p>Total cost to destination: £{{outboundDetails.details.totalCost.toFixed(2)}}</p>
</section>

<section *ngIf="returnDetails">
  <h3>Return Journey</h3>
  <mat-list
    *ngFor="
      let airport of returnDetails.details.journey;
      index as i;
      first as departure;
      last as destination
    "
  >
    <mat-list-item>
      <p matLine>{{airport}}</p>
      <p matLine *ngIf="!departure">{{returnDetails.details.miles[i - 1]}} miles</p>
    </mat-list-item>
  </mat-list>
  <p>Total cost to get back home: £{{returnDetails.details.totalCost.toFixed(2)}}</p>
  
  <h3>Total Airline Cost: £{{airlineTotalCost.toFixed(2)}}</h3>
</section>